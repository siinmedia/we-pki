<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - PKI | Pecinta Kucing Indonesia</title>
    <meta name="description" content="Baca artikel terbaru dari PKI - Pecinta Kucing Indonesia. Satu Meong, Satu Suara.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=IBM+Plex+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 10px; }
        }
        @keyframes marquee {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .scanlines {
            position: relative;
        }
        .scanlines::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(0, 0, 0, 0.2) 51%
            );
            background-size: 100% 4px;
            pointer-events: none;
            animation: scanline 1s linear infinite;
            z-index: 10;
        }
        .crt-effect {
            position: relative;
        }
        .crt-effect::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                ellipse at center,
                rgba(214, 40, 40, 0.1) 0%,
                rgba(0, 0, 0, 0.9) 100%
            );
            pointer-events: none;
            z-index: 5;
        }
        .marquee {
            white-space: nowrap;
            overflow: hidden;
            animation: marquee 15s linear infinite;
        }
        .hover-blink:hover {
            animation: blink 0.5s step-end infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .grain-effect {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.15'/%3E%3C/svg%3E");
        }
    </style>
</head>
<body class="bg-black text-amber-50 font-mono min-h-screen crt-effect scanlines grain-effect">
    <!-- Header -->
    <header class="border-b-4 border-red-700 py-4 px-6">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
            <div class="flex items-center mb-4 md:mb-0">
                <div class="bg-red-700 w-12 h-12 flex items-center justify-center mr-4">
                    <span class="text-3xl">üêæ</span>
                </div>
                <h1 class="text-2xl md:text-3xl font-bold font-['Press_Start_2P']">
                    <span class="text-red-600">PKI</span> - BLOG REVOLUSI
                </h1>
            </div>
            <nav class="flex space-x-1 md:space-x-4">
                <a href="/" class="px-2 py-1 bg-black text-amber-50 border border-red-700 hover:bg-red-700 hover:text-black transition">BERANDA</a>
                <a href="/blog.html" class="px-2 py-1 bg-red-700 text-black border border-red-700">BLOG</a>
                <a href="/#galeri" class="px-2 py-1 bg-black text-amber-50 border border-red-700 hover:bg-red-700 hover:text-black transition">GALERI</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="py-12 px-6 text-center border-b-4 border-red-700 relative overflow-hidden">
        <div class="container mx-auto max-w-4xl">
            <h2 class="text-3xl md:text-5xl font-bold mb-4 font-['Press_Start_2P'] leading-tight">
                <span class="text-red-600">BERITA</span><br>
                <span class="text-amber-200">REVOLUSI MEONG</span>
            </h2>
            <p class="text-lg md:text-xl mb-6 font-['IBM_Plex_Mono']">
                Ikuti perkembangan terbaru gerakan PKI di seluruh nusantara
            </p>
        </div>
        <div class="marquee mt-6 py-2 bg-red-700 text-black font-bold font-['Press_Start_2P']">
             üì∞ BREAKING NEWS: REVOLUSI MEONG SEMAKIN MENGUAT üì∞ BREAKING NEWS: REVOLUSI MEONG SEMAKIN MENGUAT üì∞
        </div>
    </section>

    <!-- Blog Posts -->
    <section class="py-12 px-6">
        <div class="container mx-auto max-w-6xl">
            <div id="blogPosts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Blog posts will be loaded here -->
            </div>
            
            <!-- Load More Button -->
            <div class="text-center mt-8">
                <button id="loadMoreBtn" class="px-8 py-4 bg-red-700 text-black font-bold text-xl border-4 border-black hover:border-amber-200 font-['Press_Start_2P'] transition-all">
                    MUAT LEBIH BANYAK
                </button>
            </div>
        </div>
    </section>

    <!-- Article Modal -->
    <div id="articleModal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden overflow-y-auto">
        <div class="container mx-auto px-6 py-8">
            <div class="max-w-4xl mx-auto bg-black border-4 border-red-700 relative">
                <button id="closeModal" class="absolute top-4 right-4 text-red-600 text-2xl hover:text-amber-200 z-10">
                    ‚úï
                </button>
                <div id="articleContent" class="p-8">
                    <!-- Article content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="py-8 px-6 bg-black border-t-4 border-red-700">
        <div class="container mx-auto max-w-6xl">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-6 md:mb-0">
                    <div class="bg-red-700 w-10 h-10 flex items-center justify-center mr-3">
                        <span class="text-2xl">üêæ</span>
                    </div>
                    <div>
                        <div class="text-xl font-bold font-['Press_Start_2P']">
                            PKI - PECINTA KUCING INDONESIA
                        </div>
                        <div class="text-sm font-['IBM_Plex_Mono']">
                            "Dari Meong, Oleh Meong, Untuk Meong."
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center md:text-left">
                    <a href="/" class="text-sm hover:text-red-600 transition">BERANDA</a>
                    <a href="/blog.html" class="text-sm hover:text-red-600 transition">BLOG</a>
                    <a href="/#galeri" class="text-sm hover:text-red-600 transition">GALERI</a>
                    <a href="/login.html" class="text-sm hover:text-red-600 transition">ADMIN</a>
                </div>
            </div>
            <div class="mt-8 pt-4 border-t border-red-700 text-center text-xs font-['IBM_Plex_Mono']">
                ¬© 1983-2023 PKI - Pecinta Kucing Indonesia. Semua hak dilindungi oleh kucing.
            </div>
        </div>
    </footer>

    <script type="module">
        import { BlogManager } from './src/utils/blog.js';
        import { SEOManager } from './src/components/seo.js';

        let currentPage = 0;
        const postsPerPage = 9;

        // Load initial posts
        window.addEventListener('load', () => {
            loadBlogPosts();
        });

        // Load more posts
        document.getElementById('loadMoreBtn').addEventListener('click', () => {
            currentPage++;
            loadBlogPosts(false);
        });

        // Close modal
        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('articleModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        });

        // Close modal on background click
        document.getElementById('articleModal').addEventListener('click', (e) => {
            if (e.target.id === 'articleModal') {
                document.getElementById('articleModal').classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        });

        async function loadBlogPosts(replace = true) {
            const offset = currentPage * postsPerPage;
            const result = await BlogManager.getArticles(postsPerPage, offset);
            
            if (result.success && result.data.length > 0) {
                const blogPosts = document.getElementById('blogPosts');
                const postsHTML = result.data.map(article => `
                    <article class="bg-black border-2 border-red-700 hover-blink cursor-pointer" onclick="openArticle('${article.slug}')">
                        ${article.featured_image ? `
                            <img src="${article.featured_image}" alt="${article.title}" class="w-full h-48 object-cover filter grayscale brightness-75 hover:grayscale-0 hover:brightness-100 transition">
                        ` : `
                            <div class="w-full h-48 bg-red-900 flex items-center justify-center">
                                <span class="text-6xl">üêæ</span>
                            </div>
                        `}
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2 font-['Press_Start_2P'] text-red-600 leading-tight">
                                ${article.title}
                            </h3>
                            <p class="text-sm mb-4 font-['IBM_Plex_Mono'] text-amber-200">
                                ${article.excerpt}
                            </p>
                            <div class="flex justify-between items-center text-xs text-gray-400 font-['IBM_Plex_Mono']">
                                <span>${new Date(article.created_at).toLocaleDateString('id-ID', { 
                                    year: 'numeric', 
                                    month: 'long', 
                                    day: 'numeric' 
                                })}</span>
                                <span class="text-red-600">BACA SELENGKAPNYA ‚Üí</span>
                            </div>
                        </div>
                    </article>
                `).join('');

                if (replace) {
                    blogPosts.innerHTML = postsHTML;
                } else {
                    blogPosts.innerHTML += postsHTML;
                }

                // Hide load more button if no more posts
                if (result.data.length < postsPerPage) {
                    document.getElementById('loadMoreBtn').style.display = 'none';
                }
            } else if (currentPage === 0) {
                document.getElementById('blogPosts').innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">üêæ</div>
                        <h3 class="text-2xl font-bold mb-2 font-['Press_Start_2P'] text-red-600">
                            BELUM ADA ARTIKEL
                        </h3>
                        <p class="font-['IBM_Plex_Mono'] text-amber-200">
                            Revolusi sedang dipersiapkan. Pantau terus!
                        </p>
                    </div>
                `;
                document.getElementById('loadMoreBtn').style.display = 'none';
            }
        }

        window.openArticle = async (slug) => {
            const result = await BlogManager.getArticleBySlug(slug);
            
            if (result.success) {
                const article = result.data;
                
                // Update SEO
                SEOManager.updatePageMeta({
                    title: `${article.title} - PKI Blog`,
                    description: article.excerpt,
                    image: article.featured_image,
                    url: `${window.location.origin}/blog.html?article=${slug}`,
                    type: 'article',
                    publishedDate: article.created_at,
                    modifiedDate: article.updated_at
                });

                // Show article in modal
                document.getElementById('articleContent').innerHTML = `
                    <div class="mb-6">
                        <h1 class="text-3xl md:text-4xl font-bold mb-4 font-['Press_Start_2P'] text-red-600 leading-tight">
                            ${article.title}
                        </h1>
                        <div class="flex items-center text-sm text-amber-200 font-['IBM_Plex_Mono'] mb-6">
                            <span>üìÖ ${new Date(article.created_at).toLocaleDateString('id-ID', { 
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric' 
                            })}</span>
                            <span class="mx-4">‚Ä¢</span>
                            <span>üëÅÔ∏è Artikel PKI</span>
                        </div>
                        ${article.featured_image ? `
                            <img src="${article.featured_image}" alt="${article.title}" class="w-full h-64 md:h-96 object-cover mb-6 border-2 border-red-700">
                        ` : ''}
                    </div>
                    <div class="prose prose-invert max-w-none font-['IBM_Plex_Mono'] leading-relaxed">
                        ${article.content_html}
                    </div>
                    <div class="mt-8 pt-6 border-t border-red-700">
                        <div class="flex items-center justify-between">
                            <div class="text-sm text-amber-200 font-['IBM_Plex_Mono']">
                                Bagikan revolusi ini:
                            </div>
                            <div class="flex space-x-4">
                                <button onclick="shareArticle('twitter', '${article.title}', '${slug}')" class="px-3 py-1 bg-blue-600 text-white text-sm hover:bg-blue-700 transition">
                                    Twitter
                                </button>
                                <button onclick="shareArticle('facebook', '${article.title}', '${slug}')" class="px-3 py-1 bg-blue-800 text-white text-sm hover:bg-blue-900 transition">
                                    Facebook
                                </button>
                                <button onclick="copyArticleLink('${slug}')" class="px-3 py-1 bg-gray-700 text-white text-sm hover:bg-gray-800 transition">
                                    Copy Link
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('articleModal').classList.remove('hidden');
                document.body.style.overflow = 'hidden';

                // Update URL without page reload
                window.history.pushState({}, '', `/blog.html?article=${slug}`);
            }
        };

        // Share functions
        window.shareArticle = (platform, title, slug) => {
            const url = `${window.location.origin}/blog.html?article=${slug}`;
            const text = `${title} - PKI Blog`;
            
            let shareUrl;
            if (platform === 'twitter') {
                shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
            } else if (platform === 'facebook') {
                shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }
        };

        window.copyArticleLink = (slug) => {
            const url = `${window.location.origin}/blog.html?article=${slug}`;
            navigator.clipboard.writeText(url).then(() => {
                alert('Link berhasil disalin!');
            });
        };

        // Handle direct article links
        const urlParams = new URLSearchParams(window.location.search);
        const articleSlug = urlParams.get('article');
        if (articleSlug) {
            setTimeout(() => {
                openArticle(articleSlug);
            }, 500);
        }
    </script>
</body>
</html>